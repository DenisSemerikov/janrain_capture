<?php

/**
 * @file
 * Janrain Capture.
 */

use Drupal\Core\Entity\Display\EntityViewDisplayInterface;
use Drupal\user\Entity\User;

/**
 * Implements hook_cron().
 *
 * @internal
 */
function janrain_capture_cron(): void {
  /* @var \Drupal\janrain_capture\ScreenLoaderManager $screen_loader_manager */
  $screen_loader_manager = \Drupal::service('janrain_capture.screen_loader_manager');

  if ($screen_loader_manager->isRemote()) {
    $screen_loader_manager->updateRemoteScreens();
  }
}

/**
 * Implements hook_page_attachments().
 *
 * @internal
 */
function janrain_capture_page_attachments(array &$attachments): void {
  $attachment = \Drupal::service('janrain_capture.markup_builder')->getPageAttachment();

  $attachments['#attached']['library'][] = $attachment['library'];
  $attachments['#attached']['drupalSettings']['janrain'] = $attachment['drupalSettings'];
}

/**
 * Implements hook_page_bottom().
 *
 * @internal
 */
function janrain_capture_page_bottom(array &$page_bottom): void {
  $page_bottom += \Drupal::service('janrain_capture.markup_builder')->getScreenRenderArray('signin');
}

/**
 * Implements hook_ENTITY_TYPE_view().
 *
 * @internal
 */
function janrain_capture_user_view(array &$build, User $user, EntityViewDisplayInterface $display, $view_mode): void {
  $build += \Drupal::service('janrain_capture.markup_builder')->getScreenRenderArray('public-profile');
}
